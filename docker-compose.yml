version: "3"

services:
    manager-api:
        image: manager-api
        build: ./manager-api
        ports:
            - 8000:80
        volumes:
            - ../cloud-data/config:/etc/emu-cloud
            - ../cloud-data/emuDBs:/var/emuDBs

    websocket-protocol:
        image: websocket-protocol
        build: ./websocket-protocol
        ports:
            - 17890:17890
        volumes:
            - ../cloud-data/config:/etc/emu-cloud
            - ../cloud-data/data:/var/emuDBs

    database: 
        restart: always
        image: postgres
        ports:
          - 5432:5432
        volumes:
          - ../cloud-data/postgresql-data:/var/lib/postgresql/data
        environment:
          - POSTGRES_PASSWORD summerday-root
          - POSTGRES_DB=emu
          - POSTGRES_USER=database-user
          - POSTGRES_PASSWORD=database-password

    keycloak:
        restart: always
        image: jboss/keycloak
        ports:
          - 8080:8080
        environment:
          - KEYCLOAK_USER=keycloakadmin
          - KEYCLOAK_PASSWORD=1234
          - PROXY_ADDRESS_FORWARDING=true
          - DB_VENDOR=postgres
          - DB_ADDR=database
          - DB_PORT=5432
          - DB_DATABASE=emu
          - DB_USER=database-user
          - DB_PASSWORD=database-password
